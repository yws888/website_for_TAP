# DARE TAP Assessment


Technical Requirements:
## 1. Usage of ORM:

This site is built with Django, which implements an Object-relational Mapper (ORM) that maps Python objects/classes (code) to relational database (SQLite is used here) statements. The code for these objects is located in the models.py file.



## 2. Logging of all CRUD actions.

There is a django.log file located in the online_store directory which would be created when logs are generated by the server. These logs log the HTTP requests made to API endpoints

Moreover, admin account can also view the logs in the admin page under the log entries section. Here only Create (addition), update (Change) and Delete (Deletion) actions are logged.



## 3. Explain the following in a README file.
### a. Steps required to run your application.(Please provide instructions on how to run your source code locally on our laptop in the README file.)


#### Setup (for Mac)
Change Directory (cd) to the root of this repository.

Install virtualenv if not already on your laptop (assuming pip is already installed)

```
pip install virtualenv
```

Create virtual environment

```
virtualenv venv
```

Activate virtual environment
```
source venv/bin/activate
```

Install dependencies 
```
pip install -r requirements.txt
```

Start the developmental server (Assumption is that this portion does not require a production ready server)
```
python manage.py runserver
```

Website should then be accessible at:
```
http://localhost:8000/
```

## Setup (for Windows)
Change Directory to the root of this repository.

Set up virtual environment
```
py -m venv env
```

Install dependencies 
```
py -m pip install -r requirements.txt
```

Start the server
```
py manage.py runserver
```

For the admin page, user is admin and password is admin (user/password pair created for convenience of access only)


### b. Explain how you would deploy this app on a cloud environment (Bonus: How you would do this with serverless components).


To deploy on an AWS EC2 (Ubuntu) instance (IaaS):

-Assumption: one has access to an AWS EC2 instance, is able to set it up and SSH into it,

git clone and change Directory (cd) to the root of this repository.

install binaries if not already present:
```
sudo apt-get update && sudo apt-get upgrade
sudo apt-get install python3-pip
pip install virtualenv
```

Create a virtual environment and activate it
```
virtualenv venv
source venv/bin/activate
```

Install dependencies 
```
pip install -r requirements.txt
```

Update the ALLOWED_HOSTS in settings.py file with public IP address of the EC2 instance, e.g.
```
ALLOWED_HOSTS = ["88.88.88.88"]
```

Create security rules in the AWS config settings to allow TCP incoming traffic on ports 80

Next, we would use gunicorn and nginx to have a production-ready server:

First nginx is installed:
```
sudo apt install nginx
```

Next we can create a socket file for gunicorn:
```
sudo nano /etc/systemd/system/gunicorn.socket
```

Adding the following content to it:
```
[Unit]
Description=gunicorn socket

[Socket]
ListenStream=/run/gunicorn.sock

[Install]
WantedBy=sockets.target
```

Next we can create the service file (config) for gunicorn. 
```
sudo nano /etc/systemd/system/gunicorn.service
```

change the User, WorkingDirectory, ExecStart if need be
```
[Unit]
Description=gunicorn daemon
Requires=gunicorn.socket
After=network.target

[Service]
User=ubuntu
Group=www-data
WorkingDirectory=/home/ubuntu/website_for_TAP
ExecStart=/home/ubuntu/venv/bin/gunicorn --workers 3 --bind unix:/run/gunicorn.sock website_for_TAP.wsgi:application

[Install]
WantedBy=multi-user.target
```

Start and enable the guicorn service
```
sudo systemctl start gunicorn.socket
sudo systemctl enable gunicorn.socket
```

Next we can create the configuration file for Nginx:
```
sudo nano /etc/nginx/sites-available/website_for_TAP
```

change the IP address accordingly

```
server {
    listen 80;
    server_name <IP address>;

    location = /favicon.ico { access_log off; log_not_found off; }
    location /static/ {
        root /home/ubuntu/website_for_TAP;
    }

    location / {
        include proxy_params;
        proxy_pass http://unix:/run/gunicorn.sock;
    }
}
```

create a symbolic link:
```
sudo ln -s /etc/nginx/sites-available/website_for_TAP /etc/nginx/sites-enabled/
```

Finally, restart nginx:
```
sudo systemctl restart nginx
```

If all works well, the website should be accessible on the IP address and port 80 via HTTP



c. Explain security hardening techniques on a cloud environment.

To resolve the issues of 'logging' mentioned in the writeup, the logs are stored in a file to see if there are any unexpected accesses, logins to admin accounts or CRUD operations. 

To resolve the issue of 'input validation' mentioned in the writeup, Django's admin site is secure by default and hence is generally safe against known attacks such as SQL injection

Encrypting data in transit and at rest: Using HTTPS instead of HTTP so that attackers cannot eavesdrop packets which may contain login credentials, and encrypting credentials in the database; not storing the passwords as plaintext

-Allow admin access only from VPN IP (or IP-range where legitimate traffic is expected to come from). For Django, this requires a middleware that checks IP and request path and rejects all non-VPN paths to /admin

-Create an admin honeypot (https://github.com/jamesturk/django-honeypot) and redirect the admin link elsewhere. IPs that often pop up can be sent to an email which can then be blocked.

-Adding 2FA & Captcha to admin page login for further authentication

- Setting inbound traffic rules to only allow traffic from specific ports and IP addresses

- Principle of Least Privilege: Only allow minimal privileges for accounts which require them in cloud configuration settings


Assumptions/Interpretations:

- Non-CRUD actions can be logged
- There is no memory size limitation hence collectstatic was used to collect static files for nginx
- Add to cart features are not required as payment options is not required, but can be added in future if needed

Notes on architecture decisions:


- I have used the Django framework for this website, which follows a Model-View-Template architecture. The data interface  is in the models (models.py), app business logic is in the views (views.py), and output is in the templates (html files).

![Alt text](<Screenshot 2023-09-18 at 2.55.37 pm.png>)

